<ng-template #editBlockModal let-modal>
    <app-layout-modal></app-layout-modal>
    <div class="modal-header">
        <span id="modalHeader" class="MediumSubline1H4 modal-title">Edit Block</span>
        <dfn class="def"><span class="infoIcon uk-icon" uk-icon="info"></span>
            <span rel="def">Edit a saved Block. Scenarios that use this block will be updated.
            </span>
        </dfn>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div (keydown)="enterSubmit($event)">
    <div class="title">
        <div class="BlockHeaderWarning">
            <em class="material-icons">warning</em>
            <p>Changes to a Block will be applied to EVERY Scenario referencing this Block.<br>
                This might result in Breaking Changes!</p>
            <em class="material-icons">warning</em>
        </div>
        <div class="BlockHeaderContainer">
            <div>
                <span id="scenarioHeader" class="Smallnavigation2">Block</span>
                <dfn class="def"><span class="infoIcon uk-icon" uk-icon="info"></span>
                    <span rel="def" id="blockInfoTextPosition">A Block contains Steps and can be used across Scenarios.
                        Scenarios, that have a Reference to the Block will be changed, if the Block is changed.
                    </span>
                </dfn>
            </div>
            <div>
                <span *ngIf="this.selectedBlock" id="scenarioTitle" class="MediumHeadline5"># {{selectedBlock.name }}</span>
            </div>
        </div>
    </div>
    <!--Action bar-->
    <div class="blockBarContainer">
        <div class="actionBarButtonGroup">
            <input type="checkbox" class="checkbox" id="checkbox_all" (change)="checkAllSteps(null)" [checked]="this.allChecked" uk-tooltip title="Check All Steps"/>
            <div *ngIf="this.activeActionBar">
                <button id="{{'block_deactivate_step_'}}"
                        class="actionButton" uk-tooltip title="Deactivate Step"
                        (click)="deactivateStep();">
                    <em class="material-icons">do_not_touch</em>
                </button>
                <button id="{{'block_delete_step_'}}"
                        class="actionButton" uk-tooltip title="Delete Step"
                        (click)="removeStepFromBlock();">
                    <em class="material-icons">delete</em>
                </button>
                <button id="{{'block_copy_step_'}}" a
                        class="actionButton" uk-tooltip title="Copy Step to Clipboard"
                        (click)="copyBlock();">
                    <em class="material-icons">content_copy</em>
                </button>
            </div>
        </div>
        <div class="scenarioButtonGroup SmallHeadline5">
            <button type="button" class="scenarioButton" [class.disabled]="this.clipboardBlock == null" [disabled]="this.clipboardBlock == null" uk-tooltip="Add Block from Clipboard" (click)="insertCopiedBlock()">
                <em  class="material-icons">copy_all</em>
            </button>
            <button id="block_add_step"
                    class="scenarioButton" title="Add New Step" uk-tooltip>
                <em class="material-icons">add_circle_outline</em>
            </button>
            <div uk-dropdown="pos: left-bottom">
                <ul class="uk-nav uk-dropdown-nav">
                    <li *ngFor="let step of sortedStepTypes(); let i = index" >
                        <span id="{{'backgound_add_step_type' + i}}" class="dropdownStep" *ngIf="step.stepType === 'when' && step.type !== this.newStepName" (click)="addStepToBlock(step);">
                        {{step.type}}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!--Steps-->
    <div class="uk-steps">
        <div *ngFor="let sd of getKeysList(this.selectedBlock.stepDefinitions);let i = index;" >
            <div cdkDropList (cdkDropListDropped)="onDropBlock($event, this.selectedBlock.stepDefinitions, i)">
            <div *ngFor="let currentStep of getStepList(this.selectedBlock.stepDefinitions, i); let j=index;" cdkDrag>
                <div class="text-inline SmallBody1regularLH" [class.disabled]="this.selectedBlock.stepDefinitions[currentStep.stepType][j].deactivated">
                    <div class="dragIconContainer" cdkDragHandle>
                        <em class="material-icons dragIcon">drag_indicator</em>
                    </div>
                    <input type="checkbox" class="checkbox" id="{{'block' + '_checkbox_' + j}}" (change)="this.checkStep(currentStep, null)" [checked]="currentStep.checked">
                    {{currentStep.pre}}
                    <p style="display:inline" *ngIf="currentStep.values.length > 0">
                        <input id="{{'block_step_input_pre' + j}}" #step_type_input
                               type="text" value="{{currentStep.values[0]}}" on-input="addToValuesBlock(step_type_input.value,j,0)" />
                        {{currentStep.mid}}
                        <input id="{{'block_step_input_mid' + j}}"#step_type_input *ngIf="currentStep.values[1] != null"
                               type="text" value="{{currentStep.values[1]}}" on-input="addToValuesBlock(step_type_input.value,j,1)" />
                    </p>
                    {{currentStep.post}}
                    <input id="{{'block_step_input_post' + j + n}}" #step_type_input *ngFor="let value of currentStep.values | slice:2; let n = index"
                           type="text" value="{{value}}" on-input="addToValuesBlock(step_type_input.value,j , n + 2)" />
                    <div *ngIf="currentStep.outdated">
                        <dfn class="def"><span class="infoIcon uk-icon" uk-icon="info"></span>
                            <span rel="def">
                                This step got updated. Please check if the implemented logic is still valid. When you've adjusted the step, save the block to confirm your adjustments.
                            </span>
                        </dfn>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <div id="addBlockFooter" class="modal-footer">
        <button type="button" class="normalButton"  (click)="onClickSubmit()">Save Block</button>
    </div>
    </div>
</ng-template>
